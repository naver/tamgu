# Τακτική έκφραση Tamgu

Το Tamgu παρέχει τη δική του τακτική έκφραση με την ονομασία `treg`. Το `treg` είναι ταυτόχρονα ένας τύπος και ένας συγκεκριμένος τρόπος για να γράψετε τακτικές εκφράσεις. Ως τύπος, δέχεται μια συμβολοσειρά ως όρισμα, η οποία ακολουθεί την περιγραφή που ακολουθεί παρακάτω. Μπορεί όμως να παρέχεται και απευθείας ως συμβολοσειρά, στην οποία περίπτωση η συμβολοσειρά έχει τη μορφή: `r"..."`, όπου το 'r' σημαίνει τακτική έκφραση.

## Μέθοδοι

Ο τύπος `treg` παρέχει δύο μεθόδους:

1. `compile(string rgx)`: μεταγλωττίζει μια συμβολοσειρά σε ένα αντικείμενο `treg`.
2. `match(string s)`: ελέγχει αν η συμβολοσειρά `s` ταιριάζει με την τακτική έκφραση Tamgu.

Παράδειγμα:

```cpp
treg tt("%C+");
if (tt.match("ABCDE"))
    println("Yes");
if (tt == "aABCDE")
    println("Yes");
else
    println("NO");
```

## Τακτική έκφραση r

Μπορείτε επίσης να χρησιμοποιήσετε συμβολοσειρές `r` για να εκτελέσετε τον ίδιο τύπο λειτουργίας:

```cpp
if (r"%C+" == "ABCDE")
    println("Yes");
```

Μια έκφραση `r` μπορεί να γραφεί με `""` ή `''` (διπλά ή μονά εισαγωγικά).

## Περιγραφή γλώσσας

Μια τακτική έκφραση Tamgu είναι μια συμβολοσειρά όπου χρησιμοποιούνται μετα-χαρακτήρες για να παρουσιάσουν μια συγκεκριμένη ελευθερία στην περιγραφή ενός λέξης. Αυτοί οι μετα-χαρακτήρες είναι:

- `%d`: σημαίνει οποιοδήποτε ψηφίο
- `%x`: σημαίνει ένα δεκαεξαδικό ψηφίο (abcdef0123456789ABCDEF)
- `%p`: σημαίνει οποιοδήποτε σημείο στίξης από το σύνολο: `< > { } [ ] ) , ; : . & | ! / \ = ~ # @ ^ ? + - * $ % ' _ ¬ £ €` “
- `%c`: σημαίνει οποιοδήποτε πεζό γράμμα
- `%C`: σημαίνει οποιοδήποτε κεφαλαίο γράμμα
- `%a`: σημαίνει οποιοδήποτε γράμμα
- `?`: σημαίνει οποιοδήποτε χαρακτήρα
- `%?`: σημαίνει τον χαρακτήρα “?” αυτόν καθαυτόν
- `%%`: σημαίνει τον χαρακτήρα “%” αυτόν καθαυτόν
- `%s`: σημαίνει οποιοδήποτε χαρακτήρα κενού, συμπεριλαμβανομένου του μη κατακερματισμένου κενού
- `%r`: σημαίνει έναν χαρακτήρα αλλαγής γραμμής
- `%n`: σημαίνει έναν χαρακτήρα μη κατακερματισμένου κενού
- `~`: αρνητική
- `\x`: χαρακτήρας διαφυγής
- `\ddd`: κωδικός χαρακτήρα με 3 ψηφία ακριβώς
- `\xFFFF`: κωδικός χαρακτήρα με 4 δεκαεξαδικά ψηφία ακριβώς
- `{a-z}`: μεταξύ a και z (συμπεριλαμβανομένων)
- `[a-z]`: ακολουθία χαρακτήρων
- `^`: η έκφραση πρέπει να ξεκινά από την αρχή της συμβολοσειράς
- `$`: η έκφραση πρέπει να ταιριάζει μέχρι το τέλος της συμβολοσειράς

Παράδειγμα:

- `dog%c` ταιριάζει με `dogs` ή `dogg`
- `m%d` ταιριάζει με `m0`, `m1`, ..., `m9`

### Τελεστές: `*`, `+`, `()`, `([])`

Μια τακτική έκφραση μπορεί να χρησιμοποιεί τη συμβολή του αστερίσκου του Kleene για να ορίσει χαρακτήρες που εμφανίζονται περισσότερες από μία φορές.

- `x*`: ο χαρακτήρας μπορεί να επαναλαμβάνεται 0 ή περισσότερες φορές
- `x+`: ο χαρακτήρας πρέπει να είναι παρών τουλάχιστον μία φορά
- `(x)`: ο χαρακτήρας είναι προαιρετικός
- `[xyz](+*)`: μια ακολουθία χαρακτήρων
- `{xyz}(+*)`: μια διάκριση χαρακτήρων

Εδώ, το `x` μπορεί να είναι ένας χαρακτήρας ή ένας μετα-χαρακτήρας. Υπάρχει ένα ειδικό περιστατικό με το `*` και το `+`. Εάν ο χαρακτήρας που πρόκειται να επαναληφθεί μπορεί να είναι οποιοσδήποτε χαρακτήρας, τότε πρέπει να χρησιμοποιηθεί `%+` ή `%*`.

Σημαντικό: Αυτοί οι δύο κανόνες είναι επίσης ισοδύναμοι με το `?*` ή `?+`.

Παράδειγμα:

1. `a*ed` ταιριάζει με `aed`, `aaed`, `aaaed`, κλπ. (το `a` μπορεί να είναι παρών 0 ή περισσότερες φορές)
2. `a%*ed` ταιριάζει με `aed`, `aued`, `auaed`, `aubased`, κλπ. (οποιοσδήποτε χαρακτήρας μπορεί να εμφανίζεται μεταξύ του `a` και του `ed`)
3. `a%d*` ταιριάζει με `a`, `a1`, `a23`, `a45`, `a765735`, κλπ.
4. `a{%d %p}` ταιριάζει με `a1`, `a/`, `a`, κλπ.
5. `a{bef}` ταιριάζει με `ab`, `ae`, ή `af`
6. `a{%dbef}` ταιριάζει με `a1`, `ab`, `ae`, `af`, `a0`, `a9`, κλπ.
7. `a{be}+` ταιριάζει με `ab`, `ae`, `abb`, `abe`, `abbbe`, `aeeeb`, κλπ.
8. `a[be]+` ταιριάζει με `abe`, `abebe`, κλπ.

## Μακρό: `grammar_macros(key, pattern)`

Ορισμένες εκφράσεις μπορεί να είναι λίγο πιο περίπλοκες για να γραφούν. Το Tamgu παρέχει τη διαδικασία `grammar_macros`, η οποία δημιουργεί ένα νέο μετα-χαρακτήρα που μπορεί να χρησιμοποιηθεί στις εκφράσεις. Το πρώτο όρισμα είναι ένας χαρακτήρας που θα χρησιμοποιηθεί ως δείκτης, ενώ το δεύτερο είναι ένα πρότυπο τακτικής έκφρασης που θα συσχετιστεί με αυτό το κλειδί.

Αυτή η συνάρτηση παρέχει πρότυπα για όλες τις κλήσεις των τακτικών εκφράσεων γραμματικής.

Παράδειγμα:

```cpp
grammar_macros("X", "({%+ -})0x%x+(.%x+)(p({%+ -})%d+)");
string s = "ceci est: 0x1.0d0e44bfeec9p -3 dans la chaine.";
// Χρησιμοποιούμε το μακρό
string res = s.scan("%X");
println(res); // 0x1.0d0e44bfeec9p -3
```

ΣΗΜΑΝΤΙΚΟ: Το `grammar_macros` είναι μια συστημική συνάρτηση, που σημαίνει ότι εκτελείται κατά τη διάρκεια της ανάλυσης του κώδικα. Δεν θα εκτελεστεί με τον υπόλοιπο κώδικα μετά τη μεταγλώττιση.

## Χρήση `treg` σε συμβολοσειρές

Είναι επίσης δυνατή η χρήση της `treg` απευθείας σε συμβολοσειρές για να εξάγετε ή να τροποποιήσετε το περιεχόμενό τους.

```cpp
string uu = "That was: 0x1.0d0e44bfeec9p -3, 0x3.456aebp -1 in here.";
print("Tst:<", uu[-r"%d":" "], ">\n"); // Tst:<1>
println("Tst2:", uu["x":r"%d %c"]); // Tst2: x1.0d0e44bfeec9p -3, 0x3.456aebp -1 i
```

Σημειώστε ότι είναι επίσης δυνατή η αντικατάσταση μιας τακτικής έκφρασης `treg` με μια μεταβλητή τύπου `treg`:

```cpp
treg subt(r"%d %c");
println("Tst3:", uu["x":subt]); // Tst3: x1.0d0e44bfeec9p -3, 0x3.456aebp -1 i
```

## Taskell

Μπορείτε επίσης να χρησιμοποιήσετε αυτές τις τακτικές εκφράσεις `treg` με τις συναρτήσεις του Taskell:

```cpp
<mytreg(r"%C+") = "uppercase">
<mytreg([r"%d+":v]) = "ok">
<mytreg(v) = "missed">
println(mytreg("ABC")); // uppercase
println(mytreg(["3a4", 1, 4, 5])); // ok
```

## Prolog

Μπορείτε επίσης να τις χρησιμοποιήσετε στο Prolog:

```cpp
tst(r"%d+"). // η τακτική έκφραση είναι εδώ...
tst("machin").
truc("Ok", ?P) :- tst(?P).
vector vpred;
vpred = truc(?P, "machin");
println(vpred); // [truc("Ok",machin)]
vpred = truc(?P, "12");
println(vpred); // [truc("Ok",12)]
vpred = truc(?P, "nope");
println(vpred); // []
```

## Τακτικές έκφρασεις Posix: `preg`

Οι τακτικές εκφράσεις posix είναι επίσης διαθέσιμες στο Tamgu, με τον ίδιο τρόπο με τις τακτικές εκφράσεις Tamgu. Ωστόσο, υπάρχουν δύο μικρές διαφορές. Πρώτον, για να χρησιμοποιήσετε αυτές τις εκφράσεις, πρέπει να προσθέσετε το πρόθεμα `p` αντί για το `r`. Δεύτερον, ο τύπος αντικειμένου που συσχετίζεται είναι `preg`.

Αυτές οι τακτικές εκφράσεις βασίζονται στο σχήμα των posix τακτικών εκφράσεων. Μπορούν να χρησιμοποιηθούν αντί των `treg` παντού, εκτός από τη μέθοδο `scan`, σε συμβολοσειρές και αρχεία.

Παράδειγμα:

```cpp
string str = "this subject has a submarine as a subsequence";
svector vs = p'\b(sub)([^ ]*)' in str;
println(vs); // ['subject', 'submarine', 'subsequence']
ivector iv = p'\b(sub)([^ ]*)' in str;
println(iv); // [5, 12, 19, 28, 34, 45]
string s = p'\b(sub)([^ ]*)' in str;
println(s); // subject
s = str[p"\b(sub)([^ ]*)"];
println("S=" + s); // S=subject
s = str[-p"\b(sub)([^ ]*)"];
println("S=" + s); // S=subsequence
```